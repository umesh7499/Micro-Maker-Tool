<!DOCTYPE html>
<html>
<head>
    <title>PDF Page Reorganizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- PDF-LIB -->
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>

    <!-- CONFETTI -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Your CSS -->
    <link rel="stylesheet" href="style.css">

    <style>
        /* POPUP BOX STYLE */
        #successPopup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px 35px;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            text-align: center;
            display: none;
            z-index: 9999;
            animation: popIn 0.4s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.7) translate(-50%, -50%); opacity: 0; }
            to { transform: scale(1) translate(-50%, -50%); opacity: 1; }
        }

        #successPopup h3 {
            margin: 0 0 10px;
            font-size: 22px;
            color: #28a745;
        }

        #successPopup p {
            margin: 0;
            font-size: 16px;
        }
    </style>

</head>
<body>

<h2>PDF Page Reorganizer BY Umesh J</h2>
    <br>
    <br>

<div class="container">

    <label>Upload Original PDF:</label>
    <input type="file" id="pdfFile" accept="application/pdf">

    <button onclick="reorganizePDF()">Reorganize PDF</button>

    <button class="next-tool-btn" onclick="location.href='9page.html'">
        Convert PDF to 9 Pages on 1 Sheet
    </button>

</div>

<!-- SUCCESS POPUP -->
<div id="successPopup">
    <h3>ðŸŽ‰ PDF Ready!</h3>
    <p>Your rearranged PDF has been downloaded successfully.</p>
</div>

<script>
// -------------------------------------
// CLOUD BLANK PAGE URL
// -------------------------------------
const BLANK_URL = "https://raw.githubusercontent.com/umesh7499/Micro-Maker-Tool/main/blank.pdf";


// -------------------------------------
// SHOW POPUP WITH CELEBRATION
// -------------------------------------
function showSuccessPopup() {
    const popup = document.getElementById("successPopup");
    popup.style.display = "block";

    // CONFETTI
    confetti({
        particleCount: 150,
        spread: 70,
        origin: { y: 0.6 }
    });

    // AUTO CLOSE AFTER 3 SECONDS
    setTimeout(() => {
        popup.style.display = "none";
    }, 3000);
}



// -------------------------------------
// REORGANIZE PDF using cloud blank page
// -------------------------------------
async function reorganizePDF() {
    const pdfFile = document.getElementById('pdfFile').files[0];

    if (!pdfFile) {
        alert("Please upload the Original PDF.");
        return;
    }

    const pdfBytes = await pdfFile.arrayBuffer();
    const blankBytes = await fetch(BLANK_URL).then(res => res.arrayBuffer());

    const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);
    const blankDoc = await PDFLib.PDFDocument.load(blankBytes);
    const newPdf = await PDFLib.PDFDocument.create();


    // PATTERN ROWS
    const patterns = [
        [1,3,5,7,9,11,13,15,17],
        [6,4,2,12,10,8,18,16,14],

        [19,21,23,25,27,29,31,33,35],
        [24,22,20,30,28,26,36,34,32],

        [37,39,41,43,45,47,49,51,53],
        [42,40,38,48,46,44,54,52,50],

        [55,57,59,61,63,65,67,69,71],
        [60,58,56,66,64,62,72,70,68],

        [73,75,77,79,81,83,85,87,89],
        [78,76,74,84,82,80,90,88,86],

        [91,93,95,97,99,101,103,105,107],
        [96,94,92,102,100,98,108,106,104],

        [109,111,113,115,117,119,121,123,125],
        [114,112,110,120,118,116,126,124,122],

        [127,129,131,133,135,137,139,141,143],
        [132,130,128,138,136,134,144,142,140],

        [145,147,149,151,153,155,157,159,161],
        [150,148,146,156,154,152,162,160,158]
    ];

    const totalPages = pdfDoc.getPageCount();
    const neededSets = Math.ceil(totalPages / 18);
    const rowsToUse = neededSets * 2;
    const patternsToUse = patterns.slice(0, rowsToUse);


    // BUILD FINAL PDF
    for (let row of patternsToUse) {
        for (let p of row) {
            let idx = p - 1;

            if (idx < totalPages) {
                const [copied] = await newPdf.copyPages(pdfDoc, [idx]);
                newPdf.addPage(copied);
            } else {
                const [blankPage] = await newPdf.copyPages(blankDoc, [0]);
                newPdf.addPage(blankPage);
            }
        }
    }

    // DOWNLOAD OUTPUT PDF
   // const pdfDataUri = await newPdf.saveAsBase64({ dataUri: true });
   // const link = document.createElement("a");
   // link.href = pdfDataUri;
   // link.download = "reorganized.pdf";
   // link.click();

    // SHOW CELEBRATION POPUP
   // showSuccessPopup();






    // DOWNLOAD OUTPUT PDF
const originalName = pdfFile.name.replace(".pdf", "");
const outputName = originalName + "_ORGANIZED.pdf";

const pdfDataUri = await newPdf.saveAsBase64({ dataUri: true });
const link = document.createElement("a");
link.href = pdfDataUri;
link.download = outputName;
link.click();

// SHOW CELEBRATION POPUP
showSuccessPopup();






    
}

</script>

</body>
</html>


